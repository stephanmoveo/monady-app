{"ast":null,"code":"var _jsxFileName = \"/Users/stephanbenchemoul/Documents/Projects/Moveo Skills Projects/monady-app/quickstart-react/src/components/video-js/VideoJS2.js\";\nimport React from \"react\";\nimport videojs from \"video.js\";\nimport \"video.js/dist/video-js.css\";\nimport \"./Video.css\";\nimport mondaySdk from \"monday-sdk-js\";\nimport AnnotationComments from \"@contently/videojs-annotation-comments\";\nimport \"@contently/videojs-annotation-comments/build/css/annotations.css\";\nvideojs.registerPlugin(\"annotationComments\", AnnotationComments(videojs));\nconst monday = mondaySdk();\nlet pluginOptions = {\n  annotationsObjects: [],\n  meta: {\n    user_id: null,\n    user_name: null\n  },\n  bindArrowKeys: true,\n  showControls: true,\n  showCommentList: true,\n  showFullScreen: true,\n  showMarkerShapeAndTooltips: true,\n  internalCommenting: true,\n  startInAnnotationMode: true\n};\n\nconst VideoJS2 = ({\n  src,\n  onReady,\n  index,\n  itemid\n}) => {\n  const [getComments, setGetComments] = React.useState([]);\n  const [isUpdate, setisUpdate] = React.useState(false);\n  const videoJsOptions = {\n    autoplay: false,\n    controls: true,\n    responsive: true,\n    fluid: false,\n    loop: true,\n    sources: [{\n      src: src // type: ‘video/mp4’\n\n    }]\n  };\n  const videoRef = React.useRef(null);\n  const playerRef = React.useRef(null); //   const [plugin, setplugin] = React.useState()\n\n  React.useEffect(() => {\n    // make sure Video.js player is only initialized once\n    if (!playerRef.current) {\n      const videoElement = videoRef.current;\n      if (!videoElement) return;\n      const player = playerRef.current = videojs(videoElement, videoJsOptions, () => {\n        console.log(\"plugin running\");\n        onReady && onReady(player);\n        console.log(\"in player rerender\");\n        console.log(pluginOptions);\n        var plugin = player.annotationComments(pluginOptions);\n        plugin.onReady(() => {});\n        plugin.registerListener(\"onStateChanged\", event => {\n          // event.detail = annotation state data\n          monday.storage.instance.setItem(itemid.toString() + \"k\" + index.toString(), JSON.stringify(event.detail)).then(res => {\n            console.log(res);\n          });\n        });\n      });\n    } else {\n      console.log(\"elseeee\");\n      console.log(pluginOptions);\n      const player = playerRef.current;\n      var plugin = player.annotationComments(pluginOptions);\n      plugin.onReady(() => {});\n      plugin.registerListener(\"onStateChanged\", event => {\n        // event.detail = annotation state data\n        monday.storage.instance.setItem(itemid.toString() + \"k\" + index.toString(), JSON.stringify(event.detail)).then(res => {\n          console.log(res);\n        });\n      });\n    }\n  }, [videoJsOptions, isUpdate]); // Dispose the Video.js player when the functional component unmounts\n\n  React.useEffect(() => {\n    monday.storage.instance.getItem(itemid.toString() + \"k\" + index.toString()).then(res => {\n      // setGetComments(res.data.value);\n      pluginOptions = { ...pluginOptions,\n        annotationsObjects: JSON.parse(res.data.value)\n      };\n      setisUpdate(true);\n      console.log(pluginOptions);\n    });\n    return () => {\n      if (playerRef.current) {\n        playerRef.current.dispose();\n        playerRef.current = null;\n      }\n    };\n  }, []);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    \"data-vjs-player\": true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"video\", {\n    ref: videoRef,\n    className: \"video-js vjs-big-play-centered\",\n    controls: true,\n    width: \"640\",\n    height: \"268\",\n    preload: \"auto\",\n    \"data-setup\": \"{ \\\"playbackRates\\\": [0.5, 1, 1.5, 2, 4] }\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 7\n    }\n  }));\n};\n\nexport default VideoJS2;","map":{"version":3,"sources":["/Users/stephanbenchemoul/Documents/Projects/Moveo Skills Projects/monady-app/quickstart-react/src/components/video-js/VideoJS2.js"],"names":["React","videojs","mondaySdk","AnnotationComments","registerPlugin","monday","pluginOptions","annotationsObjects","meta","user_id","user_name","bindArrowKeys","showControls","showCommentList","showFullScreen","showMarkerShapeAndTooltips","internalCommenting","startInAnnotationMode","VideoJS2","src","onReady","index","itemid","getComments","setGetComments","useState","isUpdate","setisUpdate","videoJsOptions","autoplay","controls","responsive","fluid","loop","sources","videoRef","useRef","playerRef","useEffect","current","videoElement","player","console","log","plugin","annotationComments","registerListener","event","storage","instance","setItem","toString","JSON","stringify","detail","then","res","getItem","parse","data","value","dispose"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport videojs from \"video.js\";\nimport \"video.js/dist/video-js.css\";\nimport \"./Video.css\";\nimport mondaySdk from \"monday-sdk-js\";\nimport AnnotationComments from \"@contently/videojs-annotation-comments\";\nimport \"@contently/videojs-annotation-comments/build/css/annotations.css\";\nvideojs.registerPlugin(\"annotationComments\", AnnotationComments(videojs));\nconst monday = mondaySdk();\nlet pluginOptions = {\n    annotationsObjects: [],\n    meta: { user_id: null, user_name: null },\n    bindArrowKeys: true,\n    showControls: true,\n    showCommentList: true,\n    showFullScreen: true,\n    showMarkerShapeAndTooltips: true,\n    internalCommenting: true,\n    startInAnnotationMode: true,\n  };\nconst VideoJS2 = ({ src, onReady, index, itemid }) => {\n  const [getComments, setGetComments] = React.useState([]);\n  const [isUpdate, setisUpdate] = React.useState(false);\n\n\n  const videoJsOptions = {\n    autoplay: false,\n    controls: true,\n    responsive: true,\n    fluid: false,\n    loop: true,\n    sources: [\n      {\n        src: src,\n        // type: ‘video/mp4’\n      },\n    ],\n  };\n  const videoRef = React.useRef(null);\n  const playerRef = React.useRef(null);\n//   const [plugin, setplugin] = React.useState()\n  React.useEffect(() => {\n    // make sure Video.js player is only initialized once\n    if (!playerRef.current) {\n      const videoElement = videoRef.current;\n      if (!videoElement) return;\n      const player = (playerRef.current = videojs(\n        videoElement,\n        videoJsOptions,\n        () => {\n          console.log(\"plugin running\");\n          onReady && onReady(player);\n\n          console.log(\"in player rerender\");\n          console.log(pluginOptions);\n          var plugin = player.annotationComments(pluginOptions);\n          plugin.onReady(() => {});\n          plugin.registerListener(\"onStateChanged\", (event) => {\n            // event.detail = annotation state data\n            monday.storage.instance\n              .setItem(\n                itemid.toString() + \"k\" + index.toString(),\n                JSON.stringify(event.detail)\n              )\n              .then((res) => {\n                console.log(res);\n              });\n          });\n        }\n      ));\n    } else {\n      console.log(\"elseeee\");\n      console.log(pluginOptions);\n      const player = playerRef.current;\n      var plugin = player.annotationComments(pluginOptions);\n      plugin.onReady(() => {});\n      plugin.registerListener(\"onStateChanged\", (event) => {\n        // event.detail = annotation state data\n        monday.storage.instance\n          .setItem(\n            itemid.toString() + \"k\" + index.toString(),\n            JSON.stringify(event.detail)\n          )\n          .then((res) => {\n            console.log(res);\n          });\n      });\n    }\n  }, [videoJsOptions, isUpdate]);\n  // Dispose the Video.js player when the functional component unmounts\n  React.useEffect(() => {\n    monday.storage.instance\n      .getItem(itemid.toString() + \"k\" + index.toString())\n      .then((res) => {\n        // setGetComments(res.data.value);\n        pluginOptions = {\n          ...pluginOptions,\n          annotationsObjects: JSON.parse(res.data.value),\n        };\n        setisUpdate(true)\n        console.log(pluginOptions);\n      });\n    return () => {\n      if (playerRef.current) {\n        playerRef.current.dispose();\n        playerRef.current = null;\n      }\n    };\n  }, []);\n  return (\n    <div data-vjs-player>\n      <video\n        ref={videoRef}\n        className=\"video-js vjs-big-play-centered\"\n        controls\n        width=\"640\"\n        height=\"268\"\n        preload=\"auto\"\n        data-setup='{ \"playbackRates\": [0.5, 1, 1.5, 2, 4] }'\n      />\n    </div>\n  );\n};\nexport default VideoJS2;\n"]},"metadata":{},"sourceType":"module"}